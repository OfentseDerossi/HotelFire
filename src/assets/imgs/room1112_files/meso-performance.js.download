!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=118)}({11:function(e,t,r){"use strict";window.meso=window.meso||{},window.meso.logging=window.meso.logging||[];t.a={info:(e,t)=>{window.meso.logging.push({type:"info",message:e,extra:t})},warn:(e,t)=>{window.meso.logging.push({type:"warn",message:e,extra:t})},error:(e,t)=>{window.meso.logging.push({type:"error",exception:e,extra:t})},trackEvent:(e,t,r)=>{window.meso.logging.push({type:"track-event",name:e,vars:t,events:r})},trackAction:(e,t,r)=>{window.meso.logging.push({type:"track-action",name:e,vars:t,events:r})}}},118:function(e,t,r){"use strict";r.r(t);const n=(e,t=[],r={defer:!1})=>{if(t&&t.isEventQueue)throw new Error("Meso event queue is already initialized.");const n=new class{constructor(e,t=[],r={}){if(!Array.isArray(t))throw new Error("Meso event queue requires an array.");this._callback=e,this._executedEvents=[],this._unExecutedEvents=t,this._opts=r,this.isEventQueue=!0}push(...e){this._opts.defer?setTimeout(()=>{this._executedEvents.push(...e),this._callback(...e)},0):(this._executedEvents.push(...e),this._callback(...e))}executeQueue(e=this._unExecutedEvents.length){for(;this._unExecutedEvents.length>0&&e>0;)this.push(this._unExecutedEvents.pop()),e-=1}get executedEvents(){return this._executedEvents}get unExecutedEvents(){return this._unExecutedEvents}}(e,t,r);return n.executeQueue(r.limit),n};var a=r(13),i=r(11);const o=e=>{try{void 0!==window.performance&&"function"==typeof window.performance.mark&&window.performance.mark(e)}catch(e){i.a.error(e,{adAction:"performance.mark",message:"Error creating mark"})}},s=e=>{try{void 0!==window.performance&&"function"==typeof window.performance.clearMarks&&window.performance.clearMarks(e)}catch(e){i.a.error(e,{message:"Error clearing marks",adAction:"performance.clearMarks"})}},c=(e,t,r)=>{try{void 0!==window.performance&&"function"==typeof window.performance.measure&&window.performance.measure(e,t,r)}catch(e){i.a.error(e,{message:"Error creating measure",adAction:"performance.measure"})}},d=e=>{try{void 0!==window.performance&&"function"==typeof window.performance.clearMeasures&&window.performance.clearMeasures(e)}catch(e){i.a.error(e,{message:"Error clearing measures",adAction:"performance.clearMeasures"})}},g=(e,t)=>{try{if(void 0!==window.performance&&"function"==typeof window.performance.getEntriesByName)return window.performance.getEntriesByName(e,t)}catch(e){i.a.error(e,{message:"Error getting entries by name",adAction:"performance.getEntriesByName"})}return[]};var p={mark:o,clearMarks:s,clearAndMark:e=>{s(e),o(e)},measure:c,clearMeasures:d,clearAndMeasure:(e,t,r)=>{d(e),c(e,t,r)},getEntriesByName:g,getDuration:e=>{const t=g(e,"measure");let r;return t&&t.length>0&&(r=t[0])&&r.duration?r.duration:null},getEntriesByType:e=>{try{if(void 0!==window.performance&&"function"==typeof window.performance.getEntriesByType)return window.performance.getEntriesByType(e)}catch(e){i.a.error(e,{message:"Error getting entries by type",adAction:"performance.getEntriesByType"})}return[]},getEntries:()=>{try{if(void 0!==window.performance&&"function"==typeof window.performance.getEntries)return window.performance.getEntries()}catch(e){i.a.error(e,{message:"Error getting entries by name",adAction:"performance.getEntriesByName"})}return[]},getDeprecatedTiming:()=>{try{if(void 0!==window.performance&&void 0!==window.performance.timing)return window.performance.timing}catch(e){i.a.error(e,{message:"Error getting deprecated timing",adAction:"performance.getDeprecatedTiming"})}return null},getTimeOrigin:()=>{try{return void 0!==window.performance&&void 0!==window.performance.timeOrigin?window.performance.timeOrigin:window.performance&&window.performance.timing&&window.performance.timing.navigationStart}catch(e){i.a.error(e,{message:"Error getting timeOrigin",adAction:"performance.getTimeOrigin"})}return null}};const l=e=>{if("function"==typeof URL){const t=new URL(e);return`${t.origin}${t.pathname}`}return e},u=e=>Math.floor(e),m=(e,t)=>0===e?0:u(e+t),h={initiatorType:null,decodedBodySize:null,encodedBodySize:null,transferSize:null,name:l,duration:u};["connectEnd","connectStart","fetchStart","requestStart","responseEnd","responseStart","secureConnectionStart"].forEach(e=>{h[e]=m});const f={};["domComplete","domContentLoadedEventStart","domContentLoadedEventEnd","domInteractive","loadEventEnd","loadEventStart","unloadEventEnd","unloadEventStart"].forEach(e=>{f[e]=m});const w=(e,t,r)=>Object.keys(e).filter(e=>t.hasOwnProperty(e)).reduce((n,a)=>{const i=e[a];return Object.assign({[a]:i?i(t[a],r):t[a]},n)},{}),v=(e,t)=>w(h,e,t),y=(e=[],t)=>e.map(e=>v(e,t)),b=(e,t)=>Object.assign({},v(e,t),w(f,e,t)),E=e=>Object.assign({deprecated:!0},v(e,0),w(f,e,0)),k=e=>Math.floor(Math.random()*e)+1,I=(e,t=p.getTimeOrigin())=>({name:l(e.name),fetchStart:m(e.fetchStart,t),responseEnd:m(e.responseEnd,t)}),P=()=>{const e=p.getEntriesByType("navigation"),t=p.getTimeOrigin();if(e&&e.length>0&&t)return b(e[0].toJSON(),t);const r=p.getDeprecatedTiming();return r?E(r.toJSON()):null},O=e=>{if(!e||!e.name)return null;const t="[&|?](sz|iu)=([^&]*)",r="https://securepubads.g.doubleclick.net/gampad/ads",n=new RegExp(`${r}?.*${t}.*${t}.*`),a=e.name.match(n);if(a&&a.length>=5){let t=`${r}?${a[1]}=${a[2]}&${a[3]}=${a[4]}`;return t=t.replace(/%2F/g,"/"),Object.assign({},I(e),{name:t})}return null},S=()=>({url:window.location.href,history:{state:JSON.stringify(window.history&&window.history.state),length:window.history&&window.history.length}}),x=e=>{const{event:t,startTime:r}=e,{slot:n}=t,a=n.getSlotId().getAdUnitPath(),i=n.getSizes()[0],o=i.l;return{path:a,height:i.j,width:o,marks:[{name:"slotOnLoad",startTime:r}]}},C=e=>{const{event:t,startTime:r}=e,{slot:n,isEmpty:a}=t,i=n.getSlotId().getAdUnitPath(),o=n.getSizes()[0],s=o.l,c=o.j,d={name:"slotRenderEnded",startTime:r},g="function"==typeof n.getEscapedQemQueryId?n.getEscapedQemQueryId():"";return a?{path:i,height:`${c}`,width:`${s}`,isEmpty:!0,marks:[d],googleQueryId:g}:{advertiserId:`${t.advertiserId}`||"",orderId:`${t.campaignId}`||"",creativeId:`${t.creativeId}`||"",lineItemId:`${t.lineItemId}`||"",sourceAgnosticCreativeId:`${t.sourceAgnosticCreativeId}`||"",sourceAgnosticLineItemId:`${t.sourceAgnosticLineItemId}`||"",width:`${s}`,height:`${c}`,path:i,marks:[d],googleQueryId:g}},N=e=>{if(e.performance.newResources)return(e=>({height:e.height,width:e.width,path:e.path,adUnitId:e.adUnitId||"",advertiserId:e.advertiserId||"",lineItemId:e.lineItemId||"",orderId:e.orderId||"",resources:y(e.performance.newResources,e.performance.timeOrigin||e.performance.navigationStart)}))(e);const t=e.performance.deprecatedNavigation,r=t&&t.navigationStart,n=e.performance.timeOrigin||r,a=e.performance.navigation;return{height:e.height,width:e.width,path:e.path,adUnitId:e.adUnitId||"",advertiserId:e.advertiserId||"",lineItemId:e.lineItemId||"",orderId:e.orderId||"",appNexusCreativeId:e.programmaticIds&&e.programmaticIds.appNexusCreativeId||"",appNexusMemberId:e.programmaticIds&&e.programmaticIds.appNexusMemberId||"",cmc:e.programmaticIds&&e.programmaticIds.cmc||"",resources:y(e.performance.resourceList,n),navigation:a&&a.length>0?b(a[0],n):E(t)}},A=(e,t,r,n)=>({data:{page:{instanceId:t,resources:[],navigation:null,marks:[],variant:r},displayads:[],guid:e},_config:{isCollectionEnabled:n,slots:{}}}),_=e=>e&&e._config&&e._config.isCollectionEnabled&&e.data&&e.data.displayads&&e.data.page&&e.data.page.marks&&e.data.page.resources&&(e.data.displayads.length>0||e.data.page.resources.length>0||e.data.page.marks.length>0||e.data.page.navigation),M=999999,j=["/api/v1/toolkit/","ads-loader","adinfo?","https://www.google.com/afs/ads?"],T="https://securepubads.g.doubleclick.net/gampad/ads?",$=new Set(["Page Change","Page Usable"]),U="v2";if(window&&window.navigator&&"function"==typeof window.navigator.sendBeacon&&void 0!==window.PerformanceObserver&&"function"==typeof window.URL&&"onpagehide"in self){window.meso=window.meso||{},window.meso.performance=window.meso.performance||[];const e=new class{constructor(){this.batches=[],this.trackedUrls=j,this.observer=null,this.isPageNavigationAdded=!1,this.guid="",this.currentPage={url:"",history:{}},this.addNewPageIfNecessary()}handlePerformanceEntries(e){if(!e||0===e.length)return;this.addNewPageIfNecessary();const t=e=>this.trackedUrls.some(t=>e.name.indexOf(t)>-1),r=e=>e.name.indexOf(T)>-1,n=e.filter(e=>"resource"===e.entryType&&(r(e)||t(e))).map(e=>r(e)?O(e):I(e));n.length>0&&(this.getCurrentPage().data.page.resources=this.getCurrentPage().data.page.resources.concat(n));const a=e.filter(e=>"mark"===e.entryType&&$.has(e.name)).map(e=>({name:e.name,startTime:m(e.startTime,p.getTimeOrigin())}));a.length>0&&(this.getCurrentPage().data.page.marks=this.getCurrentPage().data.page.marks.concat(a))}getCurrentPage(){return 0===this.batches.length&&this.addNewPageIfNecessary(),this.batches[this.batches.length-1]}addNewPage(e){let t,r,n;if(e&&e.data.page&&e._config)t=e.data.page.instanceId,n=e.data.page.variant,r=e._config.isCollectionEnabled;else{t=k(M);const e=a.a.performance.collectionPercentage||1,i=k(100)<=e;r=a.a.performance.enabled&&i,n=this.target?this.target.variant:""}this.batches.push(A(this.guid,t,n,r))}addNewPageIfNecessary(e){const t=e||S();t.url===this.currentPage.url&&t.history.state===this.currentPage.history.state&&t.history.length===this.currentPage.history.length||(this.currentPage=t,this.addNewPage())}enableDataCollection(){this.getCurrentPage()._config.isCollectionEnabled=!0}addPageNavigation(){this.isPageNavigationAdded||(this.isPageNavigationAdded=!0,this.getCurrentPage().data.page.navigation=P())}_addDisplayAdConfig(e,t){if(e&&e.path&&e.width&&e.height){const{path:r,width:n,height:a}=e,o=`${r}_${n}_${a}`,s=this.getCurrentPage()._config.slots,c=this.getCurrentPage().data.displayads;if(!t&&s.hasOwnProperty(o)){const t=s[o];return void(c[t]?c[t]=Object.assign({},c[t],e,{marks:c[t].marks.concat(e.marks||[]),resources:c[t].resources.concat(e.resources||[])}):i.a.error("Display ad not found for new configuration",{config:e}))}s[o]=c.length,c.push(Object.assign({marks:[],resources:[]},e))}}onSlotOnLoad(e){e&&e.event&&e.event.slot&&e.event.slot.getSlotId()&&e.event.slot.getSizes()&&e.event.slot.getSizes().length>0&&e.startTime&&this._addDisplayAdConfig(x(e),!1)}onSlotRenderEnded(e){e&&e.event&&e.event.slot&&e.event.slot.getSlotId()&&e.event.slot.getSizes()&&e.event.slot.getSizes().length>0&&e.startTime&&this._addDisplayAdConfig(C(e),!0)}addCreativeWrapperMetrics(e){e&&e.height&&e.width&&e.path&&e.performance&&this._addDisplayAdConfig(N(e),!1)}_initializeObserver(){this.observer||(this.handlePerformanceEntries(p.getEntries()),this.observer=new PerformanceObserver(e=>{this.handlePerformanceEntries(e.getEntries())}),this.observer.observe({entryTypes:["mark","resource"]}))}addMesoRenderDetails(e){this.addNewPageIfNecessary(),e&&e.params&&e.resources&&e.resources.script&&(this.target=e.params,this.getCurrentPage().data.page.variant=this.target.variant||"",this.trackedUrls=e.resources.script.filter(e=>Boolean(e.src)).map(e=>e.src).concat(this.trackedUrls),this._initializeObserver())}addTargeting(e){if(e&&e.targeting){const{mc1:t}=e.targeting;this.guid=t,this.getCurrentPage().data.guid=t}}onPageUnload(){this.isPageNavigationAdded||this.addPageNavigation(),this.sendData()}getBatches(){return this.batches}sendData(){if(navigator&&"function"==typeof navigator.sendBeacon){const e=a.a.performance.collectorWebUrl,t=this.batches.filter(e=>_(e)).map(e=>e.data);t.length>0&&navigator.sendBeacon(e,JSON.stringify({version:U,pages:t})),this.getCurrentPage()._config.isCollectionEnabled&&this.addNewPage(this.getCurrentPage())}this.batches=[this.getCurrentPage()]}},t=t=>{switch(t.type){case"displayad":e.addCreativeWrapperMetrics(t.content);break;case"pageLoad":e.addPageNavigation();break;case"pageChange":e.addNewPageIfNecessary(t.content);break;case"sendData":case"pageHidden":e.sendData();break;case"mesoRender":e.addMesoRenderDetails(t.content);break;case"targetingUpdate":e.addTargeting(t.content);break;case"slotRenderEnded":e.onSlotRenderEnded(t.content);break;case"slotOnload":e.onSlotOnLoad(t.content);break;case"log":console.log(e.getBatches());break;case"enableCollection":e.enableDataCollection();break;default:i.a.error("cmd for performance not known",{cmd:t})}},r=()=>{window.meso.performance.push({type:"pageChange",content:S()})};window.addEventListener("pagehide",()=>{e.onPageUnload()},{capture:!0});let o=!1;document.addEventListener("visibilitychange",()=>{(o="hidden"===document.visibilityState)&&setTimeout(()=>{o&&window.meso.performance.push({type:"pageHidden"})},1e3)});let s="";window.addEventListener("mesoRender",e=>{if(r(),e&&e.detail&&e.detail.config&&e.detail.params){const r=JSON.stringify(e.detail.params);if(r===s)return;s=r,window.meso.performance.isEventQueue||(window.meso.performance=n(t,window.meso.performance)),window.meso.performance.push({type:"mesoRender",content:e.detail})}});const c=()=>{window.meso.performance.push({type:"pageLoad"})};"complete"===document.readyState?c():window.addEventListener("load",()=>{c()});let d=0;document.addEventListener("MesoTargeting",e=>{e&&e.detail&&e.detail.targetingLastUpdated>d&&(r(),d=e.detail.targetingLastUpdated,window.meso.performance.push({type:"targetingUpdate",content:e.detail}))}),document.dispatchEvent(new CustomEvent("MesoTargeting",{detail:{type:"register"}}))}},13:function(e,t,r){"use strict";var n=r(14);let a;a={environmentName:"Production",environmentShort:"PROD",dfp:{network:"23171577"},adsense:{testenv:"off"},hooklogic:"https://travelads.hlserve.com",lshopsearch:"https://lshop-search-service.us-west-2.prod.expedia.com",proxy:"https://www.uciservice.com/md/api/v1/proxy",deeplink:"https://www.uciservice.com/deeplink",performance:{enabled:!0,collectionPercentage:1,collectorWebUrl:"https://www.expedia.com/cl/data/creativePerformance.json"}};const i=Object(n.a)({appName:"ads-templates",dfp:{gpt:"https://www.googletagservices.com/tag/js/gpt.js",network:"11850712",surl:"https://pubads.g.doubleclick.net/gampad/adx",gptlight:"https://securepubads.g.doubleclick.net/static/glade.js"},abacus:{endpoint:"/api/bucketing/v1"},adsense:{testenv:"on"},hooklogic:"https://dev2.travelhook.com/",lshopsearch:"https://lshop-search-service.us-west-2.test.expedia.com",proxy:"https://ads-delivery-service.us-west-2.test.expedia.com/api/v1/proxy",deeplink:"https://deep-link-service.us-west-2.test.expedia.com",others:{hotelLinkDirect:{holdoutPercentage:20}},performance:{enabled:!0,collectionPercentage:20,collectorWebUrl:"https://collector.test.expedia.com/creativePerformance.json"}},a);t.a=i},14:function(e,t,r){"use strict";var n=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===a}(e)}(e)};var a="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function o(e,t,r){return e.concat(t).map(function(e){return i(e,r)})}function s(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||o,r.isMergeableObject=r.isMergeableObject||n;var a=Array.isArray(t);return a===Array.isArray(e)?a?r.arrayMerge(e,t,r):function(e,t,r){var n={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(t){n[t]=i(e[t],r)}),Object.keys(t).forEach(function(a){r.isMergeableObject(t[a])&&e[a]?n[a]=s(e[a],t[a],r):n[a]=i(t[a],r)}),n}(e,t,r):i(t,r)}s.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,r){return s(e,r,t)},{})};var c=s;t.a=c}});
//# sourceMappingURL=meso-performance.js.map