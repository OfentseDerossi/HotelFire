($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.google-onetap",d:["vendor-babel","vendor-react-libs","vendor-redux-libs","@ta/social.onboarding-state","lithium-platform","ta-platform","@ta/memx.registration-dialog-utils","ta-common"],e:["./packages/memx/google-onetap/GoogleOneTapLoader.jsx"],x:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":["GOOGLE_PID","GOOGLE_FLOW","LOADER_TRACKING_MODULE","default"]},m:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":function(e,o,t){"use strict";t.r(o);var a=t("@babel/runtime/helpers/esm/classCallCheck"),n=t.n(a),s=t("@babel/runtime/helpers/esm/createClass"),l=t.n(s),r=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),i=t.n(r),g=t("@babel/runtime/helpers/esm/getPrototypeOf"),p=t.n(g),c=t("@babel/runtime/helpers/esm/inherits"),u=t.n(c),m=t("@babel/runtime/helpers/esm/assertThisInitialized"),d=t.n(m),_=t("@babel/runtime/helpers/esm/defineProperty"),h=t.n(_),b=t("react"),O=t("react-redux"),f=t("@ta/social.onboarding-state"),v=t("@ta/common.features"),T=t("@ta/common.tracking"),E=t.n(T),x=t("@ta/memx.registration-dialog-utils"),C={yoloIframeBase:"memx-google-onetap-GoogleOneTapLoader__yoloIframeBase--XtJgm",yoloIframeContextualMessageAdjacentDW:"memx-google-onetap-GoogleOneTapLoader__yoloIframeContextualMessageAdjacentDW--2KfUM"},M=t("@ta/common.classnames"),G=t.n(M),y=t("@ta/styleguide.icon"),I=t("@ta/common.i18n"),k=Object(O.connect)(function(e,o){return{servlet:e.meta.initialServletName,bottomPosition:o.bottomPosition}})(function e(o){var t=function a(){return{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("onetap_message_subhead_to_get_the_most")}}(),n=o.bottomPosition||0;return Object(v.featureIsEnabled)("google_onetap_contextual_message_mobile")&&n?b.createElement("div",{className:G()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageMobileDevice--3b5il"),style:{bottom:"".concat(n,"px")}},b.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},b.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},b.createElement(y.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),t.headline))):b.createElement("div",{className:G()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageDesktopTablet--zsYLB")},b.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},b.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},b.createElement(y.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),t.headline),b.createElement("p",{className:"memx-google-onetap-GoogleOneTapContextualMessage__subhead--YO-_R"},t.subhead)))}),A=["Home","Tourism","MobileTourism","ShowTopic","MobileShowTopic"];function j(){return Object(v.featureIsEnabled)("google_onetap_contextual_message_desktop")||Object(v.featureIsEnabled)("google_onetap_contextual_message_mobile")}t.d(o,"GOOGLE_PID",function(){return N}),t.d(o,"GOOGLE_FLOW",function(){return L}),t.d(o,"LOADER_TRACKING_MODULE",function(){return S});var N=40185,L="GOOGLE_ONETAP",S="google_onetap",w=0,R=function(e){function o(e){var t;return n()(this,o),t=i()(this,p()(o).call(this,e)),h()(d()(d()(t)),"onGoogleYoloLoad",function(){return(t.props.adhesionRendered||j())&&t.props.googleApi.addClassName(C.yoloIframeBase).addClassName(C.yoloIframeContextualMessageAdjacentDW,function(){return Object(v.featureIsEnabled)("google_onetap_contextual_message_desktop")&&t.state.isMessageEligible}).captureIframeEvents(t.onOneTapHeightChange),t.props.adhesionRendered&&t.trackAction("google_onetap_adhesion_detected"),Object(v.featureIsEnabled)("google_onetap_web_component_autologin")&&!Object(x.userSignedOut)()?t.retrieve():t.hint()}),h()(d()(d()(t)),"onOneTapHeightChange",function(e){t.setState({googleOneTapHeight:e}),e>0&&t.props.adhesionRendered&&(t.moveGoogleOneTapIframeForAdhesion(),Object(x.moveAdCloseX)(!1),t.trackAction("google_onetap_modal_moved_above_adhesion"))}),h()(d()(d()(t)),"handleOneTapException",function(){t.resetState(),t.props.triggerNext()}),h()(d()(d()(t)),"handleOneTapSuccess",function(e){t.resetState(),e.idToken&&(Object(x.moveAdCloseX)(!0),t.showRegOverlay(e))}),h()(d()(d()(t)),"handleAutoLoginError",function(e){Object(x.moveAdCloseX)(!0),t.resetState(),"noCredentialsAvailable"!==e.type?"userCanceled"===e.type?t.props.onDismiss():t.props.triggerNext():t.hint()}),h()(d()(d()(t)),"handleOneTapError",function(e){Object(x.moveAdCloseX)(!0),t.resetState(),"userCanceled"===e.type?t.props.onDismiss():t.props.triggerNext()}),t.state={isMessageEligible:!1,googleOneTapHeight:w},t}return u()(o,e),l()(o,[{key:"componentDidMount",value:function e(){if(function o(e,t){return!!function a(e){return!Object(v.featureIsEnabled)("google_onetap_web_component_hotel_servlets")&&x.HOTEL_SERVLETS.includes(e)}(t)||!!function n(){return!Object(v.featureIsEnabled)("google_onetap_web_component_mobile_adhesion")&&Object(v.featureIsEnabled)("mobile_fixed_ad")}()||!Object(v.featureIsEnabled)("google_onetap_web_component_mobile")&&!Object(v.featureIsEnabled)("google_onetap_web_component_desktop")}(this.props.viewportCategory,this.props.servlet))this.props.triggerNext();else if(this.trackAction("google_onetap_requested"),A.includes(this.props.servlet)||Object(v.featureIsEnabled)("google_onetap_web_component")){var t=Object(v.featureIsEnabled)("mobile_web")?null:"navPopout";this.props.googleApi.load(t,null).then(this.onGoogleYoloLoad)}}},{key:"componentDidUpdate",value:function e(o){o.adhesionRendered&&!this.props.adhesionRendered&&this.moveGoogleOneTapIframeForAdhesion()}},{key:"moveGoogleOneTapIframeForAdhesion",value:function e(){var o=document.getElementsByClassName(C.yoloIframeBase);if(o&&0!==o.length){var t=this.props.adhesionRendered?50:0;o[0].style.bottom="".concat(t,"px")}}},{key:"calculateMessageBottomPosition",value:function e(){return(this.props.adhesionRendered?50:0)+this.state.googleOneTapHeight-39}},{key:"resetState",value:function e(){(this.state.isMessageEligible||this.state.googleOneTapHeight!==w)&&this.setState({isMessageEligible:!1,googleOneTapHeight:w})}},{key:"retrieve",value:function e(){return this.props.googleApi.retrieve().then(this.handleOneTapSuccess,this.handleAutoLoginError).catch(this.handleOneTapException)}},{key:"hint",value:function e(){return this.setState({isMessageEligible:!0}),this.props.googleApi.hint().then(this.handleOneTapSuccess,this.handleOneTapError).catch(this.handleOneTapException)}},{key:"showRegOverlay",value:function e(o){var t=this;window.require(["ta/registration/RegOverlay"],function(e){var a="MOBILE"===t.props.viewportCategory;e.showRegOverlay(null,null,a,{flow:L,pid:N,userRequestedForce:"true",extraQueryParams:{google_id_token:o.idToken},displayOnShowOverlay:!0,onSuccess:function e(o){o&&o.user_id&&("Home"!==t.props.servlet?Object(v.featureIsEnabled)("app_dl_for_got_and_fbot")&&t.props.setShouldFire(!1,"GOOGLE_ONETAP_NON_HOME"):t.props.setShouldFire(!1,"GOOGLE_ONETAP"))}})})}},{key:"trackAction",value:function e(o){E()({module:S,action:o,context:"".concat(o.replace(/^google_onetap_/,""),"_").concat(this.props.servlet||"unknown","_").concat(L),value:N})}},{key:"render",value:function e(){return!this.state.isMessageEligible||!j()||this.state.googleOneTapHeight<=0?null:b.createElement(k,{bottomPosition:this.calculateMessageBottomPosition()})}}]),o}(b.Component);o.default=Object(O.connect)(function(e){return{isMember:e.auth.isMember,servlet:e.meta.initialServletName,viewportCategory:e.meta.device.viewportCategory}},{setShouldFire:f.ACTIONS.setShouldFire})(R)}}});
//# sourceMappingURL=memx.google-onetap.6e891bb2c5.js.map