($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/common.infinite-loader",d:["vendor-babel","vendor-react-libs","ta-platform"],e:["./packages/common/infinite-loader/index.jsx"],x:{"./packages/common/infinite-loader/index.jsx":["InfiniteLoader","InfiniteLoaderObserver","default"]},m:{"./packages/common/infinite-loader/index.jsx":function(e,n,t){"use strict";t.r(n);var r=t("@babel/runtime/helpers/esm/classCallCheck"),i=t.n(r),o=t("@babel/runtime/helpers/esm/createClass"),l=t.n(o),a=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),s=t.n(a),c=t("@babel/runtime/helpers/esm/getPrototypeOf"),d=t.n(c),u=t("@babel/runtime/helpers/esm/inherits"),h=t.n(u),f=t("@babel/runtime/helpers/esm/assertThisInitialized"),m=t.n(f),b=t("@babel/runtime/helpers/esm/defineProperty"),p=t.n(b),v=t("react"),L=t("@ta/common.logging"),M=t.n(L),R=t("@ta/common.throttle"),g=t.n(R),S=8,k=function(e){function n(){var e,t;i()(this,n);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return t=s()(this,(e=d()(n)).call.apply(e,[this].concat(o))),p()(m()(m()(t)),"contentRef",v.createRef()),p()(m()(m()(t)),"containerRef",v.createRef()),p()(m()(m()(t)),"observer",void 0),p()(m()(m()(t)),"numberOfLoadMores",S),p()(m()(m()(t)),"infiniteScrollEnabled",!1),p()(m()(m()(t)),"isLoading",!1),p()(m()(m()(t)),"useWindow",function(){return!t.containerRef.current}),p()(m()(m()(t)),"isContentVisible",function(){if(!t.contentRef.current)return!1;var e=t.contentRef.current.getBoundingClientRect(),n=t.props.threshold;return t.useWindow()?window.innerHeight>=e.bottom-n:!(t.containerRef&&!t.containerRef.current)&&t.containerRef.current.getBoundingClientRect().bottom>=e.bottom-n}),p()(m()(m()(t)),"executeLoadMore",function(){return t.props.loadMore().catch(function(e){M.a.error("infinite loader error: ",e)}).then(function(){return t.numberOfLoadMores-=1,t.props.hasMore&&t.isContentVisible()&&t.numberOfLoadMores>0?t.executeLoadMore():(t.numberOfLoadMores<0&&M.a.error("Attempted to load more than 10 times without scroll handler, do you have an infinite loop?"),t.isLoading=!1,Promise.resolve())})}),p()(m()(m()(t)),"checkToLoadMore",function(){t.props.hasMore&&t.infiniteScrollEnabled&&t.isContentVisible()&&!t.isLoading&&(t.numberOfLoadMores=S,t.isLoading=!0,t.executeLoadMore())}),p()(m()(m()(t)),"enableInfiniteScroll",function(){t.infiniteScrollEnabled=!0,t.checkToLoadMore()}),p()(m()(m()(t)),"handleScroll",t.props.throttle?g()(t.checkToLoadMore,t.props.throttle,!1):t.checkToLoadMore),t}return h()(n,e),l()(n,[{key:"componentDidMount",value:function e(){this.useWindow()?(window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleScroll)):this.containerRef.current&&(this.containerRef.current.addEventListener("scroll",this.handleScroll),this.containerRef.current.addEventListener("resize",this.handleScroll)),this.props.infiniteLoadOnMount&&(this.infiniteScrollEnabled=!0,this.checkToLoadMore())}},{key:"componentWillUnmount",value:function e(){this.infiniteScrollEnabled=!1,this.useWindow()?(window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleScroll)):this.containerRef.current&&(this.containerRef.current.removeEventListener("scroll",this.handleScroll),this.containerRef.current.removeEventListener("resize",this.handleScroll))}},{key:"render",value:function e(){return this.props.children(this.containerRef,this.contentRef,this.enableInfiniteScroll,this.infiniteScrollEnabled)}}]),n}(v.Component);p()(k,"defaultProps",{throttle:200});var w=k,E=t("@babel/runtime/helpers/esm/slicedToArray"),y=t.n(E),C=t("@ta/common.is-visible"),x=function e(n){var t=n.threshold,r=n.hasMore,i=n.loadMore,o=n.checkVisibilityDelay,l=n.children,a=n.triggerNode,s=v.useState(!1),c=y()(s,2),d=c[0],u=c[1],h=v.useCallback(function(){r&&i(),u(!0)},[r,i]);v.useEffect(function(){var e=setTimeout(function(){d&&r&&h()},o);return function(){return clearTimeout(e)}},[d,r,h,o]);var f=v.useCallback(function(){return u(!1)});return v.createElement(C.VisibilityObserver,{rootMargin:"".concat(t,"px"),onVisible:h,onInvisible:f,node:a},l)};x.defaultProps={checkVisibilityDelay:1e3};var O=x;t.d(n,"InfiniteLoader",function(){return w}),t.d(n,"InfiniteLoaderObserver",function(){return O}),n.default={}}}});
//# sourceMappingURL=common.infinite-loader.2beeb48e7a.js.map