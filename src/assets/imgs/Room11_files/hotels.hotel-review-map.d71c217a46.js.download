($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/hotels.hotel-review-map",d:["vendor-react-libs","vendor-redux-libs","vendor-babel","ta-platform","lithium-platform","@ta/public.maps","@ta/maps.alsoshowresults","@ta/common.poller","@ta/maps.fetch","@ta/maps.controls","@ta/maps.carousel","@ta/maps.also-show-control","@ta/maps.redo-search-button","@ta/maps.find-location-button","@ta/maps.popups","@ta/maps.markers"],e:["./packages/hotels/hotel-review-map/hotel-review-map.jsx"],x:{"./packages/hotels/hotel-review-map/hotel-review-map.jsx":["default"]},m:{"./packages/hotels/hotel-review-map/hotel-review-map.jsx":function(e,t,o){"use strict";o.r(t);var a=o("react"),n=o("react-redux"),r=o("@babel/runtime/helpers/esm/classCallCheck"),s=o.n(r),l=o("@babel/runtime/helpers/esm/createClass"),i=o.n(l),c=o("@babel/runtime/helpers/esm/possibleConstructorReturn"),u=o.n(c),h=o("@babel/runtime/helpers/esm/getPrototypeOf"),p=o.n(h),d=o("@babel/runtime/helpers/esm/inherits"),m=o.n(d),v=o("@babel/runtime/helpers/esm/assertThisInitialized"),f=o.n(v),g=o("@babel/runtime/helpers/esm/defineProperty"),S=o.n(g),b=o("@ta/common.radio"),w=o.n(b),y=o("@ta/common.features"),k=o("@ta/public.maps"),M=o("@ta/maps.alsoshowresults"),L=o("@babel/runtime/helpers/esm/objectSpread"),I=o.n(L),E=o("@ta/maps.controls"),_=o("@ta/maps.carousel"),C=o("@ta/maps.also-show-control"),R=o("@ta/maps.redo-search-button"),P=o("@ta/maps.find-location-button"),H=o.n(P),B=o("@ta/maps.popups"),O=o("@ta/maps.markers"),A=function(e){function t(e){var o;return s()(this,t),o=u()(this,p()(t).call(this,e)),S()(f()(f()(o)),"alsoShowOptions",void 0),S()(f()(f()(o)),"onMapLoaded",function(e){o.setState({mapInterface:e.map,lastSearchBBox:e.map.getBounds()})}),S()(f()(f()(o)),"onLocationHoverStart",function(e){"DESKTOP"===o.props.viewportCategory&&o.setState(function(){return{hoveredMarker:e}})}),S()(f()(f()(o)),"onLocationHoverEnd",function(e){o.setState(function(t){return t.hoveredMarker&&t.hoveredMarker.id===e.id?{hoveredMarker:null}:null})}),S()(f()(f()(o)),"onPrimaryPinSelected",function(e){e?(o.state.visitedLocations[e.id]=!0,o.setState({selectedMarker:e,hoveredMarker:null,carouselState:o.props.detailLocation&&o.props.detailLocation.id===e.id?"selected_marker":"primary_results"})):o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),S()(f()(f()(o)),"onSecondaryPinSelected",function(e){e?(o.state.visitedLocations[e.id]=!0,o.setState({selectedMarker:e,hoveredMarker:null,carouselState:"selected_marker"})):o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),S()(f()(f()(o)),"onMapClick",function(){o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),S()(f()(f()(o)),"onRedoSearch",function(){var e=o.state.mapInterface;if(e){var t=e.getBounds();o.props.onRedoSearch(t),o.setState({lastSearchBBox:t})}else o.props.onRedoSearch(null)}),S()(f()(f()(o)),"onCarouselSwipe",function(e){var t=o.state.mapInterface;t&&t.panIntoView(new k.LatLng(e.geoPoint.latitude,e.geoPoint.longitude),{left:48,right:48,top:48,bottom:200}),o.setState({selectedMarker:e})}),S()(f()(f()(o)),"toggleAlsoShowOption",function(e,t){var a=Object.assign({},o.state.selectedAlsoShowOptions,S()({},e.value,t)),n=o.state.carouselState;e.value!==M.AlsoShowValues.hotels||t||"primary_results"!==o.state.carouselState||(n="hidden"),o.setState({selectedAlsoShowOptions:a,carouselState:n}),t&&o.onRedoSearch()}),S()(f()(f()(o)),"clearAlsoShowOptions",function(){var e=o.state.carouselState;"primary_results"===e&&(e="hidden"),o.setState({selectedAlsoShowOptions:{},carouselState:e})}),o.alsoShowOptions=Object(M.buildAlsoShowItems)([M.AlsoShowValues.hotels,M.AlsoShowValues.restaurants,M.AlsoShowValues.thingsToDo]),o.state={mapInterface:null,hoveredMarker:null,selectedMarker:void 0,carouselState:"hidden",hasFitResults:!1,selectedAlsoShowOptions:o.props.defaultAlsoShowOptions,visitedLocations:{},lastSearchBBox:null},"MOBILE"===e.viewportCategory&&(o.state.carouselState="selected_marker",o.state.selectedMarker=e.detailLocation),o}return m()(t,e),i()(t,[{key:"componentDidUpdate",value:function e(){if(!this.props.loading&&!this.state.hasFitResults){var t=this.state.mapInterface;if(t){var o=this.calcLatLngBounds();o&&t.setBounds(o,{left:50,right:50,top:50,bottom:50}),this.setState(I()({hasFitResults:!0},o?{lastSearchBBox:o}:{}))}}}},{key:"calcLatLngBounds",value:function e(){var t=this.props.nearbyHotels.map(function(e){return new k.LatLng(e.geoPoint.latitude,e.geoPoint.longitude)});return t.push(new k.LatLng(this.props.detailLocation.geoPoint.latitude,this.props.detailLocation.geoPoint.longitude)),t.length>=2?k.LatLngBounds.fromArray(t):null}},{key:"render",value:function e(){var t=this.props,o=t.detailLocation,n=t.onClose,r=this.state,s=r.selectedMarker,l=r.hoveredMarker,i=r.selectedAlsoShowOptions,c=r.visitedLocations,u=r.hasFitResults,h=l?l.id:0,p=s?s.id:0,d="DESKTOP"===this.props.viewportCategory,m="MOBILE"===this.props.viewportCategory,v=i[M.AlsoShowValues.hotels],f=Object.keys(i).filter(function(e){return i[e]}).length>0,g=null;"primary_results"===this.state.carouselState?g=this.props.nearbyHotels:"selected_marker"===this.state.carouselState&&s&&(g=[s]);var S=m&&g&&g.length;return a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__container--ULPxh"},a.createElement(E.ModalHeader,{locationName:o.name,onClose:n}),a.createElement(k.MapComponent,{className:"hotels-hotel-review-map-HRMapview__mapContainer--3Pkl6",initialCenter:new k.LatLng(o.geoPoint.latitude,o.geoPoint.longitude),initialZoom:15,onLoad:this.onMapLoaded,onClick:this.onMapClick},a.createElement(M.AlsoShowResultsController,{blacklist:null,showSelectedMarker:m,selectedMarker:p,hoveredMarker:h,boundingBox:this.state.lastSearchBBox,isVisited:c,showRestaurants:i[M.AlsoShowValues.restaurants],showAttractions:i[M.AlsoShowValues.thingsToDo],showHotels:!1,onMarkerMouseEnter:this.onLocationHoverStart,onMarkerMouseLeave:this.onLocationHoverEnd,onMarkerClick:this.onSecondaryPinSelected}),a.createElement(O.AnchorMarkers,{locations:[o],hoveredMarker:h,selectedMarker:p,visited:{},showSelectedMarker:m,onMouseEnter:this.onLocationHoverStart,onMouseLeave:this.onLocationHoverEnd,onClick:this.onPrimaryPinSelected}),v&&a.createElement(O.PrimaryMarkers,{locations:this.props.nearbyHotels,hoveredMarker:h,selectedMarker:p,visited:c,showSelectedMarker:m,onMouseEnter:this.onLocationHoverStart,onMouseLeave:this.onLocationHoverEnd,onClick:this.onPrimaryPinSelected}),a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__headerShadow--2LsJJ"}),d&&!!l&&l!==s&&a.createElement(B.LocationHoverPopup,{location:l}),v&&0===this.props.nearbyHotels.length&&!this.props.loading&&a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__noResultsBanner--2Q5Zu"},a.createElement(E.NoResultsBanner,null)),!m&&s&&a.createElement(B.LocationPopup,{location:s,autoPan:!0}),S&&a.createElement(_.CardCarousel,{locations:g||[],selectedMarker:p,onSwipe:this.onCarouselSwipe}),v&&this.props.loading&&a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__loadingBar--gfzGx"},a.createElement(E.LoadingBar,null)),a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__zoomControl--9jjY8"},a.createElement(E.ZoomControl,null)),f&&u&&a.createElement("div",{className:"hotels-hotel-review-map-HRMapview__redoSearchContainer--ozYRO"},m?a.createElement(E.RoundedRedoSearchButton,{onRedoSearch:this.onRedoSearch}):a.createElement(R.RedoSearchButton,{onRedoSearch:this.onRedoSearch})),a.createElement("div",{className:"".concat("hotels-hotel-review-map-HRMapview__alsoShowContainer--1CLHm"," ").concat(S?"hotels-hotel-review-map-HRMapview__carouselShown--3YPUG":"")},a.createElement(C.AlsoShowControl,{options:this.alsoShowOptions,selectedValues:this.state.selectedAlsoShowOptions,onValueChange:this.toggleAlsoShowOption,onClearOptions:this.clearAlsoShowOptions,mobile:m})),a.createElement("div",{className:"".concat("hotels-hotel-review-map-HRMapview__findLocationButton--3aSUg"," ").concat(S?"hotels-hotel-review-map-HRMapview__carouselShown--3YPUG":"")},a.createElement(H.a,null))))}}]),t}(a.PureComponent),x=Object(n.connect)(function(e){return{viewportCategory:e.meta.device.viewportCategory}})(A),N=o("@ta/common.poller"),D=o.n(N),j=o("@ta/maps.fetch"),T=o.n(j),q=function(e){function t(){var e,o;s()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return o=u()(this,(e=p()(t)).call.apply(e,[this].concat(r))),S()(f()(f()(o)),"state",{requestNumber:1}),S()(f()(f()(o)),"poll",function(){o.setState({requestNumber:o.state.requestNumber+1})}),S()(f()(f()(o)),"parseData",function(e,t){if(e){var o=e.hotels,a=e.hacStatus,n=a&&a.isHacComplete;if(o&&1===o.length){var r=o[0],s=r.offers&&r.offers.filter(function(e){return!!e.providerInfo}).map(function(e){return{offerClickToken:e.offerClickToken,price:e.price,status:e.status,provider:e.providerInfo.name,isInstantBook:e.providerInfo.isInstantBook}});return{location:{entityType:"hotel",id:r.location.id,geoPoint:r.location.geoPoint,numReviews:r.location.numReviews,thumbnail:r.location.thumbnail,name:r.location.name,bubbleRating:r.location.bubbleRating,detailUrl:r.location.detailUrl,popIndexText:r.popIndexMessage,listingKey:r.listingKey,offers:s,sponsoredListing:r.sponsoredListing},complete:n}}}return{location:null,complete:!!t}}),S()(f()(f()(o)),"renderWithResponse",function(e){var t=e.loading,n=e.data,r=e.error;return a.createElement(a.Fragment,null,a.createElement(D.a,{loading:t,complete:!!n&&n.complete,requestNumber:o.state.requestNumber,poll:o.poll}),o.props.children({loading:t,location:n?n.location:null,error:r}))}),o}return m()(t,e),i()(t,[{key:"render",value:function e(){var t="/data/1.0/mapsEnrichment/hotel/".concat(this.props.locationId),o=["rn=".concat(this.state.requestNumber),"rc=Hotel_Review","stayDates=".concat(this.props.stayDates),"guestInfo=".concat(this.props.guestInfo),"placementName=Hotel_Review_MapDetail_Anchor","currency=".concat(this.props.currencyCode)];this.props.fetchThumbnail&&o.push("getThumbnail=true");var n="".concat(t,"?").concat(o.join("&"));return a.createElement(T.a,{url:n,parser:this.parseData},this.renderWithResponse)}}]),t}(a.PureComponent);S()(q,"defaultProps",{fetchThumbnail:!1});var U=Object(n.connect)(function(e,t){var o=e.travelerInfo&&e.travelerInfo.hotels,a="",n="";return o&&(a=o.stayDates,n=o.guests),{locationId:t.locationId,stayDates:a,guestInfo:n,currencyCode:e.i18n.currencyCode}})(q),V=function e(t){if(t){var o=t.hotels,a=t.hacStatus,n=t.paging,r=a&&(a.isHacComplete||a.hacPercentComplete>90),s=0===n.totalItems||r;return{locations:o.map(function(e){var t=e.offers&&e.offers.map(function(e){return{offerClickToken:e.offerClickToken,price:e.price,status:e.status,provider:e.providerInfo&&e.providerInfo.name,isInstantBook:e.providerInfo&&e.providerInfo.isInstantBook}});return{entityType:"hotel",id:e.location.id,geoPoint:e.location.geoPoint,numReviews:e.location.numReviews,thumbnail:e.location.thumbnail,name:e.location.name,bubbleRating:e.location.bubbleRating,detailUrl:e.location.detailUrl,popIndexText:e.popIndexMessage,listingKey:e.listingKey,offers:t}}),complete:s}}return{locations:[],complete:!0}},K=function e(t,o){var a=t.bbox,n=t.stayDates,r=t.guestInfo,s=t.geoId,l=t.centerLat,i=t.centerLng,c="/data/1.0/hotels/".concat(s).concat(a?"/proximity":""),u=["rn=".concat(o.requestNumber),"rc=Hotel_Review","stayDates=".concat(n),"guestInfo=".concat(r),"useExactFilters=true","placementName=Hotel_Review_MapDetail","pageSize=15","navArea=Meta_Map_Detail","currency=".concat(t.currencyCode)];return a?(u.push("sort=popularity"),u.push("minLat=".concat(a.southwest.lat)),u.push("maxLat=".concat(a.northeast.lat)),u.push("minLng=".concat(a.southwest.lng)),u.push("maxLng=".concat(a.northeast.lng))):(u.push("sort=distLow"),u.push("centerLat=".concat(l)),u.push("centerLng=".concat(i))),"".concat(c,"?").concat(u.join("&"))},F=function(e){function t(){var e,o;s()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return o=u()(this,(e=p()(t)).call.apply(e,[this].concat(r))),S()(f()(f()(o)),"state",{requestNumber:1}),S()(f()(f()(o)),"currentUrl",null),S()(f()(f()(o)),"poll",function(){o.setState({requestNumber:o.state.requestNumber+1})}),S()(f()(f()(o)),"renderWithResponse",function(e){var t=e.loading,n=e.data,r=e.error,s=V(n),l=(s.locations||[]).filter(function(e){return e.id!==o.props.detailId&&!!e.geoPoint});return a.createElement(a.Fragment,null,a.createElement(D.a,{loading:t,complete:s.complete,requestNumber:o.state.requestNumber,poll:o.poll}),o.props.children({loading:t||!s.complete&&o.state.requestNumber<15,locations:l,error:r}))}),o}return m()(t,e),i()(t,[{key:"componentDidUpdate",value:function e(){var t=K(this.props,this.state);this.currentUrl!==t&&this.setState({requestNumber:1})}},{key:"render",value:function e(){var t=K(this.props,this.state);return this.currentUrl=t,a.createElement(T.a,{url:t},this.renderWithResponse)}}]),t}(a.Component),W=Object(n.connect)(function(e){var t=e.travelerInfo&&e.travelerInfo.hotels,o="",a="";return t&&(o=t.stayDates,a=t.guests),{stayDates:o,guestInfo:a,currencyCode:e.i18n.currencyCode}})(F),z=function(e){function t(e){var o;return s()(this,t),o=u()(this,p()(t).call(this,e)),S()(f()(f()(o)),"radio",void 0),S()(f()(f()(o)),"performSearch",function(e){o.setState({searchBbox:e,searchEnabled:!0})}),S()(f()(f()(o)),"refreshPrices",function(){o.setState({anchorQueryKey:(new Date).toString()})}),o.state={searchBbox:null,anchorQueryKey:"initial",detailLocation:null,loading:!1,nearbyHotels:[],searchEnabled:Object(y.featureIsEnabled)("hr_location_hotel_pins")},o}return m()(t,e),i()(t,[{key:"componentDidMount",value:function e(){this.radio=w()("hr-map"),this.radio&&this.radio.on("refreshPrices",this.refreshPrices)}},{key:"componentWillUnmount",value:function e(){this.radio&&this.radio.off("refreshPrices",this.refreshPrices)}},{key:"render",value:function e(){var t,o=this,n=this.state,r=n.detailLocation,s=n.searchEnabled,l=Object(y.featureIsEnabled)("hr_react_map_default_nearby_r_a"),i=Object(y.featureIsEnabled)("hr_location_hotel_pins"),c=!Object(y.featureIsEnabled)("hotels_media_mas_maps");return a.createElement(a.Fragment,null,a.createElement(U,{key:this.state.anchorQueryKey,locationId:this.props.locationId,fetchThumbnail:c},function(e){var t=e.location;return t&&o.state.detailLocation!==t&&o.setState({detailLocation:t}),null}),r&&s&&a.createElement(W,{bbox:this.state.searchBbox,geoId:this.props.geoId,detailId:this.props.locationId,centerLat:r.geoPoint.latitude,centerLng:r.geoPoint.longitude},function(e){var t=e.loading,a=e.locations;o.setState({loading:t,nearbyHotels:a||[]})}),r&&a.createElement("div",{style:{width:"100%",height:"100%"}},a.createElement(x,{defaultAlsoShowOptions:(t={},S()(t,M.AlsoShowValues.restaurants,l),S()(t,M.AlsoShowValues.thingsToDo,l),S()(t,M.AlsoShowValues.hotels,i),t),detailLocation:r,onClose:this.props.onClose,loading:this.state.loading,nearbyHotels:this.state.nearbyHotels,onRedoSearch:this.performSearch})))}}]),t}(a.PureComponent);t.default=Object(n.connect)(function(e){var t,o;return{detailId:null===(t=e.page)||void 0===t?void 0:t.detailId,geoId:(null===(o=e.page)||void 0===o?void 0:o.geoId)||0}})(function e(t){var o=t.close,n=t.detailId,r=t.geoId;return n?a.createElement("div",{className:"hotels-hotel-review-map-hotel-review-map__mapModalContainer--n-YX3"},a.createElement(z,{onClose:o,locationId:n,geoId:r})):null})}}});
//# sourceMappingURL=hotels.hotel-review-map.d71c217a46.js.map