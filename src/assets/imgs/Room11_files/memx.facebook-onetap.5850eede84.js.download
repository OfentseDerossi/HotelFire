($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.facebook-onetap",d:["vendor-babel","vendor-react-libs","vendor-redux-libs","vendor-common","lithium-platform","ta-platform","@ta/memx.registration-dialog-utils","@ta/overlays.pieces","@ta/social.onboarding-state"],e:["./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx"],x:{"./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx":["default"]},m:{"./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx":function(e,a,o){"use strict";o.r(a);var t=o("@babel/runtime/helpers/esm/classCallCheck"),n=o.n(t),s=o("@babel/runtime/helpers/esm/createClass"),i=o.n(s),r=o("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=o.n(r),l=o("@babel/runtime/helpers/esm/getPrototypeOf"),d=o.n(l),b=o("@babel/runtime/helpers/esm/inherits"),p=o.n(b),u=o("@babel/runtime/helpers/esm/assertThisInitialized"),m=o.n(u),f=o("@babel/runtime/helpers/esm/defineProperty"),k=o.n(f),_=o("react"),g=o("react-redux"),h=o("js-cookie"),O=o.n(h),v=o("@ta/common.classnames"),F=o.n(v),T=o("@ta/common.features"),w=o("@ta/common.i18n"),x=o("@ta/common.logging"),E=o.n(x),A=o("@ta/common.tracking"),C=o.n(A),L=o("@ta/memx.registration-dialog-utils"),y=o("@ta/overlays.pieces"),I=o("@ta/social.onboarding-state"),S=function(e){function a(e){var o;return n()(this,a),o=c()(this,d()(a).call(this,e)),k()(m()(m()(o)),"onFacebookInit",function(){o.setState({fbSdkInitialized:!0}),window.FB.Event.subscribe("xfbml.render",function(){o.trackAction("facebook_onetap_rendered")}),window.FB.getLoginStatus(function(e){"connected"===e.status||"not_authorized"===e.status?o.setState({fbUserLoggedIn:!0}):(o.setState({disabled:!0}),o.props.triggerNext())})}),k()(m()(m()(o)),"onFacebookLogin",function(){o.trackAction("facebook_onetap_clicked"),window.FB.getLoginStatus(function(e){if("connected"===e.status){var a=e.authResponse;a&&a.accessToken?o.onFacebookAccountConnected(a.signedRequest):E.a.warn("Error in reading login request from Facebook")}})}),k()(m()(m()(o)),"onFacebookAccountConnected",function(e){var a=o.parseFBSignedRequest(e);a&&a.code?(O.a.set("FacebookAuthCode2",a.code,{expires:new Date((new Date).getTime()+5e3),domain:o.props.cookieDomain,path:"/"}),window.require(["ta/registration/RegOverlay"],function(e){var a="MOBILE"===o.props.viewportCategory;e.showRegOverlay(null,null,a,{flow:"FACEBOOK_ONETAP",pid:40600,userRequestedForce:"true",extraQueryParams:{social:"true"},displayOnShowOverlay:!0,onClose:function e(){o.dismissFbOneTap()},onSuccess:function e(a){a&&a.user_id&&(o.disableFbOneTap(),"Home"!==o.props.servlet?Object(T.featureIsEnabled)("app_dl_for_got_and_fbot")&&o.props.setShouldFire(!1,"FACEBOOK_ONETAP_NON_HOME"):o.props.setShouldFire(!1,"FACEBOOK_ONETAP"))}})})):E.a.warn("Error in parsing signed request from Facebook")}),k()(m()(m()(o)),"parseFBSignedRequest",function(e){if(!e)return null;var a=e.split(".",2)[1];if(a){var t=atob(a);try{return JSON.parse(t)}catch(e){o.trackAction("facebook_onetap_parseSignedRequestFailed")}}return null}),k()(m()(m()(o)),"dismissFbOneTap",function(){o.disableFbOneTap(),o.trackAction("facebook_onetap_closed"),o.props.onDismiss()}),k()(m()(m()(o)),"disableFbOneTap",function(){o.state.disabled||(o.setState({disabled:!0}),Object(L.moveAdCloseX)(!0))}),o.state={fbSdkInitialized:!1,fbUserLoggedIn:!1,disabled:o.isFacebookOneTapDisabled()},o}return p()(a,e),i()(a,[{key:"componentWillMount",value:function e(){this.state.disabled&&this.props.triggerNext()}},{key:"componentDidMount",value:function e(){var a=this;this.state.disabled?this.props.triggerNext():(this.trackAction("facebook_onetap_requested"),window.require(["facebook/authutils"],function(e){e.loadSdkAndInit(a.props.fbSdkUrl,a.props.fbConnectAppId,a.props.fbApiVersion),e.queueForInit(a.onFacebookInit)}))}},{key:"isFacebookOneTapDisabled",value:function e(){return!(Object(T.featureIsEnabled)("facebook_onetap_hotel_servlets")||!L.HOTEL_SERVLETS.includes(this.props.servlet))||!(Object(T.featureIsEnabled)("facebook_onetap_mobile_adhesion")||!Object(T.featureIsEnabled)("mobile_fixed_ad"))||!Object(T.featureIsEnabled)("facebook_onetap_mobile")&&!Object(T.featureIsEnabled)("facebook_onetap_desktop")}},{key:"trackAction",value:function e(a){C()({module:"facebook_onetap",action:a,context:"".concat(this.props.servlet||"unknown")})}},{key:"render",value:function e(){if(this.state.disabled||!this.state.fbSdkInitialized||!this.state.fbUserLoggedIn)return null;var a;this.props.adhesionRendered?(a=50,Object(L.moveAdCloseX)(!1)):a=0;var o={headline:Object(w.localize)("onetap_message_unlock"),subhead:Object(w.localize)("onetap_subhead_signin_alerts_deals")};return Object(T.featureIsEnabled)("t10349_facebook_onetap_w_value_copy")&&(o={headline:Object(w.localize)("mg2019_fbot_see_where_friends_traveled"),subhead:Object(w.localize)("onetap_subhead_signin_alerts_deals")}),window.onFacebookOneTapLogin=this.onFacebookLogin,setTimeout(function(){window.FB.XFBML.parse()},50),_.createElement("div",{className:"MOBILE"===this.props.viewportCategory?F()("memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageContainer--2-Az3","memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageMobileDevice--1xICl"):F()("memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageContainer--2-Az3","memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageDesktopTablet--YpYwT"),style:{bottom:"".concat("MOBILE"===this.props.viewportCategory?"".concat(a,"px"):"unset")}},_.createElement(y.CloseX,{close:this.dismissFbOneTap}),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageInnerContainer--bb6RY"},_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__headline--3xXmn"},_.createElement("div",null,o.headline)),_.createElement("p",{className:"memx-facebook-onetap-FacebookOneTapLoader__subhead--1Ver3"},o.subhead),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__loginButtonContainer--19Y0X"},_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__continueWithButton--3oNq1"},_.createElement("div",{className:"fb-login-button","data-width":"100%","data-max-rows":"1","data-size":"large","data-button-type":"continue_with","data-show-faces":"true","data-auto-logout-link":"false","data-use-continue-as":"true","data-scope":"email, user_hometown, user_friends, user_likes, user_location, user_status, user_photos","data-onlogin":"window.onFacebookOneTapLogin();",style:{width:"100%"}}))),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__disclaimer--1Y5vP"},Object(w.unescaped)(Object(w.localize)("terms_and_policy_links",{0:"/pages/terms.html",1:"/pages/privacy.html",2:"legalLink"})))))}}]),a}(_.Component);a.default=Object(g.connect)(function(e){return{fbApiVersion:e.auth.fbApi.apiVersion,fbConnectAppId:e.auth.fbApi.facebookConnectAppId,fbSdkUrl:e.auth.fbApi.sdkUrl,servlet:e.meta.initialServletName,cookieDomain:e.meta.cookieDomain,viewportCategory:e.meta.device.viewportCategory}},{setShouldFire:I.ACTIONS.setShouldFire})(S)}}});
//# sourceMappingURL=memx.facebook-onetap.5850eede84.js.map