($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/maps.snapshot",d:["vendor-babel","vendor-react-libs","vendor-redux-libs","ta-platform","ta-common","@ta/maps.provider-names"],e:["./packages/maps/snapshot/snapshot.jsx"],x:{"./packages/maps/snapshot/MapSnapshot.jsx":["a"],"./packages/maps/snapshot/assetCatalogue.jsx":["a"]},m:{"./packages/maps/snapshot/MapSnapshot.jsx":function(e,t,n){"use strict";var a=n("@babel/runtime/helpers/esm/objectSpread"),s=n.n(a),o=n("@babel/runtime/helpers/esm/classCallCheck"),i=n.n(o),r=n("@babel/runtime/helpers/esm/createClass"),p=n.n(r),m=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=n.n(m),l=n("@babel/runtime/helpers/esm/getPrototypeOf"),u=n.n(l),h=n("@babel/runtime/helpers/esm/inherits"),d=n.n(h),g=n("@babel/runtime/helpers/esm/assertThisInitialized"),v=n.n(g),_=n("@babel/runtime/helpers/esm/defineProperty"),f=n.n(_),b=n("react"),P=n("react-redux"),k=n("@ta/common.logging"),S=n.n(k),j=n("@ta/common.tracking"),x=n.n(j),R=n("@ta/media.image"),y=function(e){function t(){var e,n;i()(this,t);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return n=c()(this,(e=u()(t)).call.apply(e,[this].concat(s))),f()(v()(v()(n)),"state",{snapshotUrl:null}),f()(v()(v()(n)),"urlRequest",void 0),f()(v()(v()(n)),"requestUrl",void 0),f()(v()(v()(n)),"requestTimeout",void 0),f()(v()(v()(n)),"mounted",void 0),n}return d()(t,e),p()(t,[{key:"componentDidMount",value:function e(){this.mounted=!0,this.loadSnapshot()}},{key:"componentDidUpdate",value:function e(){this.loadSnapshot()}},{key:"componentWillUnmount",value:function e(){this.urlRequest=null,this.mounted=!1,clearTimeout(this.requestTimeout)}},{key:"loadSnapshot",value:function e(){var t=this;if(this.mounted){var n=this.buildUrl();n&&this.requestUrl!==n&&(this.requestUrl=n,clearTimeout(this.requestTimeout),this.requestTimeout=setTimeout(function(){if(t.mounted){var e=fetch(n,{credentials:"same-origin"});t.urlRequest=e,t.urlRequest.then(function(e){return e.json()}).then(function(n){e===t.urlRequest&&(t.setState({snapshotUrl:n.url}),x()({module:"staticmap",action:"load",context:n.mapProvider}))}).catch(function(e){t.setState({snapshotUrl:null}),x()({module:"staticmap",action:"failed",context:n}),S.a.error("Error loading snapshot",e)})}},100))}}},{key:"buildUrl",value:function e(){var t,n=this.props;if((n.width||0)<1||(n.height||0)<1)return S.a.error("StaticMapSnapshot - Width (".concat(n.width,") and height (").concat(n.height,") params must be positive values")),null;if(n.zoom&&(n.zoom<1||n.zoom>19))return S.a.error("StaticMapSnapshot - Zoom (".concat(n.width,") must be between 1 and 19.")),null;var a=function e(t){var n=[];return Object.keys(t).forEach(function(e){var a=t[e];if(null!=a){var s=a.toString();n.push([encodeURIComponent(e),encodeURIComponent(s)].join("="))}}),n.join("&")}({center:[n.center.lat,n.center.lng].join(","),width:n.width,height:n.height,zoom:n.zoom,geoId:n.geoId,servletName:n.servletName,scale:n.scale,forceMapProvider:n.forceMapProvider});return(null===(t=this.props.markers)||void 0===t?void 0:t.length)&&(a+="&".concat(function e(t){var n={};return t&&t.length?(t.forEach(function(e){if(e){var t=e.iconUrl,a=[e.position.lat,e.position.lng];n[t]?n[t].push(a):n[t]=[a]}}),Object.keys(n).map(function(e){return"markers=".concat(e,"|").concat(n[e].join("|"))}).join("&")):""}(this.props.markers))),"/data/1.0/maps/staticmap?".concat(a)}},{key:"render",value:function e(){var t=this.props;return b.createElement("span",{"data-test-target":"staticMapSnapshot",className:t.className},this.state.snapshotUrl&&(t.lazy?b.createElement(R.LazyImage,{className:t.imgClassName,src:this.state.snapshotUrl,alt:""}):b.createElement("img",{className:t.imgClassName,src:this.state.snapshotUrl})))}}]),t}(b.Component);f()(y,"defaultProps",{alt:"",className:"",imgClassName:"",scale:1,zoom:13,forceMapProvider:null,markers:[],lazy:!1}),t.a=Object(P.connect)(function(e,t){return s()({},t,{geoId:e.page.geoId,servletName:e.meta.initialServletName})})(y)},"./packages/maps/snapshot/assetCatalogue.jsx":function(e,t,n){"use strict";t.a={attractionPin:"img2/maps/icons/component_map_pins_v1/A_Pin_Small.png",miniAttractionPin:"img2/maps/icons/component_map_pins_v1/A_Pin_xs.png",anchorAttractionPin:"img2/maps/icons/responsive_map_pins_v2/AR_Anchor_pin.png",hotelPin:"img2/maps/icons/component_map_pins_v1/H_Pin_Small.png",miniHotelPin:"img2/maps/icons/component_map_pins_v1/H_Pin_xs.png",anchorHotelPin:"img2/maps/icons/responsive_map_pins_v2/H_Anchor_pin.png",restaurantPin:"img2/maps/icons/component_map_pins_v1/R_Pin_Small.png",miniRestaurantPin:"img2/maps/icons/component_map_pins_v1/R_Pin_xs.png",anchorRestaurantPin:"img2/maps/icons/responsive_map_pins_v2/R_Anchor_pin.png",rentalPin:"img2/maps/icons/responsive_map_pins_v1/VR_green_pin.png",anchorRentalPin:"img2/maps/icons/responsive_map_pins_v2/VR_Anchor_pin.png"}},"./packages/maps/snapshot/snapshot.jsx":function(e,t,n){"use strict";n.r(t);var a=n("./packages/maps/snapshot/MapSnapshot.jsx"),s=n("@ta/maps.provider-names");for(var o in s)["SnapshotAssetCatalogue","default"].indexOf(o)<0&&function(e){n.d(t,e,function(){return s[e]})}(o);var i=n("./packages/maps/snapshot/assetCatalogue.jsx");n.d(t,"SnapshotAssetCatalogue",function(){return i.a}),t.default=a.a}}});
//# sourceMappingURL=maps.snapshot.0df808ae29.js.map