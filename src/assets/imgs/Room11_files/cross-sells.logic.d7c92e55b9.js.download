($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/cross-sells.logic",d:["vendor-babel","vendor-react-libs","ta-platform","vendor-common","vendor-redux-libs","lithium-platform","@ta/common.poller","@ta/cross-sells.types"],e:["./packages/cross-sells/logic/index.jsx"],x:{"./packages/cross-sells/logic/endpointUtil.jsx":["d","c","e","b","a"],"./packages/cross-sells/logic/index.jsx":["UiAssetLoader","ComparisonGridDataLoader","WaitForPageLocation","getUIAssets","CrossSellsDisplayStateManager","sponsoredListingClickHandler","LogClickInteraction","sponsoredListingImpressionHandler","gaRecordClickHandler","ShelfTimingTracker","getTitleForCrossSellType","getDefaultShelfTitle","getSeeAllUrlForCrossSellType"]},m:{"./node_modules/webpack/buildin/global.js":function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},"./packages/cross-sells/logic/endpointUtil.jsx":function(e,t,i){"use strict";(function(e){i.d(t,"d",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"e",function(){return d}),i.d(t,"b",function(){return u}),i.d(t,"a",function(){return p});var n=i("@ta/common.logging"),a=i.n(n),s=i("lodash/get"),o=i.n(s),r=function e(t,i){var n=new Date;n.setDate(n.getDate()+t),i.push(n.getFullYear()),i.push(n.getMonth()+1),i.push(n.getDate())},l=function e(t,i){var n={detailId:i.featuredAccommodation,requestNumber:t.page.crossSells.requestNumber,configuration:i.configuration,requestCaller:i.requestCaller};return function e(t,i,n){var a=i.travelerInfo&&i.travelerInfo.hotels;if(a)t.stayDates=a.stayDates,t.guests=a.guests,t.paramSeqId=a.paramSeqId||0;else{var s=[];r(1,s),r(2,s),t.stayDates=s.join("_"),t.guests="1_1",t.paramSeqId=0}t.requestNumber>1&&(t.searchKey=o()(i,"page.crossSells.endpointResults.searchKey",null)),n.sponsoredListingsEnabled&&(1===t.requestNumber?t.sponsoredListingData={}:t.sponsoredListingData=o()(i,"page.crossSells.endpointResults.sponsoredListingData")),i.tracking&&i.tracking.uid&&(t.pageLoadUid=o()(i,"tracking.uid",null))}(n,t,i),n},c=function e(t,i){var n=new URLSearchParams;if(n.append("rn",String(t.requestNumber)),n.append("stayDates",t.stayDates),n.append("guestInfo",t.guests),n.append("csc",t.configuration),n.append("rc",t.requestCaller),t.sponsoredListingData){var s=Object.assign({},t.sponsoredListingData);delete s.debugData,n.append("sld",JSON.stringify(s))}t.requestNumber>i.length&&n.append("ifp",""),t.searchKey&&n.append("sk",t.searchKey),t.pageLoadUid&&n.append("puid",t.pageLoadUid),t.paramSeqId&&n.append("paramSeqId",String(t.paramSeqId));var o="/data/1.0/crosssellaccommodations/".concat(t.detailId,"?").concat(n.toString());return a.a.info("new url generated: ".concat(o)),o},d=function e(t){var i=t.accommodationsByType,n=t.pageLocations,a=t.isSearchComplete,s=t.sponsoredListingData,o=t.searchKey,r=n.reduce(function(e,t){return e[t.locationName]={crossSells:t.crossSellTypes.map(function(e){return i[e]}),locationName:t.locationName},e},{});return{pageLocations:n,locationMap:r,isSearchComplete:a,sponsoredListingData:s,searchKey:o}},u=function e(t,i){return"/data/1.0/crosssellaccommodations/".concat(t,"/uiAssets/").concat(i)},p=function t(i){window.__SP_DEBUG_EVENTS__=window.__SP_DEBUG_EVENTS__||[],i.forEach(function(e){return window.__SP_DEBUG_EVENTS__.push(e)}),e.require("ta/Core/TA.FireEvent").fireEvent("sp_debug_refresh")}}).call(this,i("./node_modules/webpack/buildin/global.js"))},"./packages/cross-sells/logic/index.jsx":function(e,t,i){"use strict";i.r(t);var n=i("@babel/runtime/helpers/esm/classCallCheck"),a=i.n(n),s=i("@babel/runtime/helpers/esm/createClass"),o=i.n(s),r=i("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=i.n(r),c=i("@babel/runtime/helpers/esm/getPrototypeOf"),d=i.n(c),u=i("@babel/runtime/helpers/esm/inherits"),p=i.n(u),m=i("react"),g=i("@ta/common.api"),_=function(e){function t(e){var i;return a()(this,t),i=l()(this,d()(t).call(this,e)),e.data,i}return p()(t,e),o()(t,[{key:"render",value:function e(){return null}}]),t}(m.Component),h=Object(g.bind)({data:function e(t,i){var n=i("/data/1.0/crosssellaccommodations/comparisongridcrosssellsuiassets/");return function(e){var t=n.get(),i=t.data;return t.loading||!i?{}:{data:i}}},actions:{}})(_),f=i("@ta/common.state"),v=i("./packages/cross-sells/logic/endpointUtil.jsx"),k=function(e){function t(e){var i;return a()(this,t),(i=l()(this,d()(t).call(this,e))).props.updateCrossSellEndpointData(i.props.data),i}return p()(t,e),o()(t,[{key:"render",value:function e(){return null}}]),t}(m.Component),S=Object(g.bind)({data:function e(t,i){var n=i("/data/1.0/crosssellaccommodations/comparisongridcrosssells");return function(e){var t=n.get(),i=t.data;return t.loading||!i?{loading:!0}:e.page.crossSells.updatingResults?{updatingXSellResults:!0}:{data:Object(v.e)(i)}}},actions:{updateCrossSellEndpointData:f.actions.page.hotelreview.setCrossSellsEndpointResults}})(k),y=i("@babel/runtime/helpers/esm/objectSpread"),b=i.n(y),D=i("react-redux"),N=i("@ta/common.features"),T=i("@ta/common.logging"),I=i.n(T),C=i("@babel/runtime/helpers/esm/assertThisInitialized"),O=i.n(C),w=i("@babel/runtime/helpers/esm/defineProperty"),E=i.n(w),L=i("@ta/common.poller"),j=i("@babel/runtime/helpers/esm/objectWithoutProperties"),x=i.n(j),A=i("@ta/cross-sells.types"),q=i("@ta/common.tracking"),R=i.n(q),P={module:"hr_xsell_skeleton",action:"xsell_show"},H={module:"hr_xsell_skeleton",action:"xsell_collapse"},V={module:"hr_xsell_skeleton",action:"xsell_remains_hidden"},W=function e(t,i){return{displayState:t,updateWithNewData:i}},F=function e(t,i,n,a,s){switch(t){case A.DisplayState.HIDDEN:return function e(t,i,n){return t?(R()(P),W(A.DisplayState.SHOWING,!0)):i?(n&&R()(V),W(A.DisplayState.HIDDEN,!1)):(R()(P),W(A.DisplayState.LOADING,!0))}(i,n,s);case A.DisplayState.LOADING:return function e(t,i){return t?W(A.DisplayState.SHOWING,!0):i?(R()(H),W(A.DisplayState.HIDDEN,!0)):W(A.DisplayState.LOADING,!1)}(i,n);default:return function e(t,i,n){return t?W(A.DisplayState.SHOWING,!0):i?(R()(H),W(A.DisplayState.HIDDEN,!0)):1===n?W(A.DisplayState.LOADING,!0):W(A.DisplayState.SHOWING,!1)}(i,n,a)}},U=function e(t,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t===A.DisplayState.SHOWING){if(i||n)return W(A.DisplayState.SHOWING,!1)}else t===A.DisplayState.LOADING&&R()(H);return W(A.DisplayState.HIDDEN,t!==A.DisplayState.HIDDEN)},G=function e(){var t=this;a()(this,e),E()(this,"displayStates",void 0),E()(this,"previousResults",void 0),E()(this,"shouldShowIncompleteResults",void 0),E()(this,"calculateDisplayStates",function(e,i){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.accommodationsByType,s=x()(e,["accommodationsByType"]),o={},r=Object.keys(a),l=0;l<r.length;l++){var c=r[l],d=a[c],u=!1;t.displayStates[c]||(t.displayStates[c]=A.DisplayState.HIDDEN,u=!0);var p=t.displayStates[c],m=d.accommodations.length>0,g=d.isOverallComplete,_=void 0;if(n){var h=t.shouldShowIncompleteResults[c];_=U(p,g,h)}else _=F(p,m,g,i,u);_.updateWithNewData&&(t.displayStates[c]=_.displayState);var f=b()({},d,_);o[c]=f}var v=b()({accommodationsByType:o},s);return t.previousResults=v,v}),E()(this,"calculateTimeoutStates",function(){return t.calculateDisplayStates(t.previousResults,0,!0)}),this.displayStates={},this.shouldShowIncompleteResults={n:!0,c:!0,m:!0}},M=[10,1e3,1e3,1e3,1e3,1500,1500,1500,2e3,2e3,2e3],K=function(e){function t(e){var i;return a()(this,t),i=l()(this,d()(t).call(this,e)),E()(O()(O()(i)),"displayManager",void 0),E()(O()(O()(i)),"pollingDelay",void 0),E()(O()(O()(i)),"pollingTimedOut",function(){I.a.info("Polling timed out! requests made: ".concat(i.props.urlData.requestNumber));var e=i.displayManager.calculateTimeoutStates(),t=Object(v.e)(e);i.props.updateCrossSellEndpointData(t)}),E()(O()(O()(i)),"timerContainer",new L.TimerContainer),i.displayManager=new G,i.pollingDelay=M,i}return p()(t,e),o()(t,[{key:"componentDidMount",value:function e(){this.props.skipOnLoadSearch||this.fetchCrossSellData()}},{key:"componentDidUpdate",value:function e(t){this.urlParamsChanged(t.urlData)&&!this.props.updatingXSellResults&&this.fetchCrossSellData()}},{key:"urlParamsChanged",value:function e(t){var i=this.props.urlData;return t.requestNumber!==i.requestNumber||t.stayDates!==i.stayDates||t.guests!==i.guests||t.detailId!==i.detailId||t.configuration!==i.configuration||t.requestCaller!==i.requestCaller}},{key:"fetchCrossSellData",value:function e(){var t=this,i=this.props.urlData;!function e(t){return!!(t.detailId&&t.stayDates&&t.guests)}(i)?I.a.debug("will not request from server. We do not expect to get any results for these params: ".concat(JSON.stringify(i))):function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return Promise.race([fetch(t,{method:"GET",header:{"Content-Type":"application/json"},credentials:"same-origin"}),new Promise(function(e,t){return setTimeout(function(){return t(new Error("timeout"))},i)})])}(Object(v.c)(i,this.pollingDelay)).then(function(e){if(e.ok||e.status>=200&&e.status<300)return e;var t="ResponseStatus: ".concat(e.status," Invalid results from server: ").concat(JSON.stringify(e));return 400===e.status&&(t="".concat("Will stop polling."," ").concat(t)),Promise.reject(new Error(t))}).then(function(e){return e.json()}).then(function(e){var i=t.displayManager.calculateDisplayStates(e,t.props.urlData.requestNumber);i.sponsoredListingData&&i.sponsoredListingData.debugData&&Object(v.a)(i.sponsoredListingData.debugData);var n=Object(v.e)(i);t.props.updateCrossSellEndpointData(n),n.isSearchComplete||t.triggerPoll()}).catch(function(e){var i;I.a.warn("something went wrong making the request. Will trigger another poll just in case... Error is: ".concat(e)),(null==e?void 0:null===(i=e.message)||void 0===i?void 0:i.startsWith("Will stop polling."))||t.triggerPoll()})}},{key:"triggerPoll",value:function e(){var t={poll:this.props.poll,pollingDelay:this.pollingDelay,requestNumber:this.props.urlData.requestNumber,loading:!1,complete:!1,timedOut:this.pollingTimedOut};I.a.debug("Poller info: ".concat(JSON.stringify(t))),Object(L.setTimer)(t,this.timerContainer)}},{key:"render",value:function e(){return null}}]),t}(m.Component),J=Object(D.connect)(function(e,t){return b()({},t,{urlData:Object(v.d)(e,t),updatingXSellResults:e.page.crossSells.updatingResults})},{poll:f.actions.page.hotelreview.crossSellsPoll,updateCrossSellEndpointData:f.actions.page.hotelreview.setCrossSellsEndpointResults})(K),B=function(e){function t(e){var i;a()(this,t),i=l()(this,d()(t).call(this,e));var n="locationPhotoDirectLink"===e.requestCaller,s=Object(N.featureIsEnabled)("t4b_hr_xsell_sponsored_slot_0_display")&&!n;return i.state={didWeLoadContainer:!1,sponsoredListingsEnabled:s,serverSideSponsoredHotelSelectionEnabled:s&&Object(N.featureIsEnabled)("hr_xsell_server_side_sponsored_hotel_selection")},i}return p()(t,e),o()(t,null,[{key:"getDerivedStateFromProps",value:function e(t,i){return!i.didWeLoadContainer&&t.didALocationRegister?(function e(t,i,n){t&&fetch(Object(v.b)(t,i),{method:"GET",header:{"Content-Type":"application/json"},credentials:"same-origin"}).then(function(e){if(e.ok)return e;throw I.a.debug("Error fetching UIAssets: ".concat(JSON.stringify(e))),new Error(e.statusText)}).then(function(e){return e.json()}).then(function(e){n(e)})}(t.featuredAccommodation,t.xsellConfig,t.setUIAssets),{didWeLoadContainer:!0}):null}}]),o()(t,[{key:"render",value:function e(){var t=null;if(this.props.didALocationRegister&&this.state.didWeLoadContainer){var i={configuration:this.props.xsellConfig,featuredAccommodation:this.props.featuredAccommodation,requestCaller:this.props.requestCaller?this.props.requestCaller:"hotelReview",sponsoredListingsEnabled:this.state.sponsoredListingsEnabled,serverSideSponsoredHotelSelectionEnabled:this.state.serverSideSponsoredHotelSelectionEnabled,skipOnLoadSearch:this.props.skipOnLoadSearch};t=m.createElement(J,i)}return t}}]),t}(m.Component),X=Object(D.connect)(function(e,t){return b()({},t,{didALocationRegister:!t.wait&&e.page.crossSells.atLeastOneLocationRegistered,featuredAccommodation:e.route.detail})},{setUIAssets:f.actions.page.hotelreview.setUIAssets})(B),Y=i("lodash/get"),$=i.n(Y),z=function e(){var t=Object(f.getStore)().getState();return $()(t,"page.crossSells.uiAssets")},Q=i("js-cookie"),Z=i.n(Q),ee=function e(){return window.JS_SECURITY_TOKEN},te=function e(t,i,n){fetch("/data/1.0/tap/recordEvent",{method:"POST",headers:new Headers({"content-type":"application/json","x-requested-by":ee()}),credentials:"same-origin",body:JSON.stringify({eventType:n,requestGuid:t,externalId:i})}).then(function(e){return e.ok||I.a.error("Did not get an ok. got: ".concat(e.statusText)),e}).catch(function(e){I.a.error("Error sending TripAds click event: ".concat(e.message))})},ie=function e(){return window.JS_SECURITY_TOKEN},ne=function e(){var t=Object(f.getStore)().getState(),i=t.page,n=t.tracking;return{page_geo_id:i.geoId,request_num:i.crossSells?i.crossSells.requestNumber:0,request_uid:n.uid?n.uid:void 0}},ae=function e(t,i,n,a){if(t){var s=t;I.a.debug("about to send user tracking log"),function e(t,i){Object(q.trackEventWithContext)("action",i?"paid_backup_sponsored_listing_click":"dfp_sponsored_listing_click",t)}(function e(t,i,n,a){var s=ne();return b()({},s,{is_dynamic_listing:!1,placement_slot_name:t.placement_slot_name,slot_index:n,location_id:i,sponsored_type:t.sponsored_type,candidate_location_ids:t.candidate_location_ids,chosen_location_id:i,has_valid_candidate:!0,current_state:"location_shown",opportunity_uid:t.opportunity_uid,dfp_lineitem_id:t.dfp_lineitem_id,sl_line_item_id:t.sl_line_item_id,trip_ads_id:t.trip_ads_id,ik:t.impression_key,tt_placement:t.tt_placement,trip_ads_select_guid:t.trip_ads_select_request_guid,listing_key:a})}(s,i,n,a),s.is_backfill),I.a.debug("about to fire holistic tracking"),Object(q.trackHolisticEvent)(q.holisticEvents.HOTELS_SP_CLICK,function e(t,i,n){var a=Object(f.getStore)().getState();return{is_member:a.auth.isMember,device_type:a.meta.device.userAgentCategory?a.meta.device.userAgentCategory.toLowerCase():"",locationId:i,slot:t.placement_slot_name,trip_ads_select_guid:t.trip_ads_select_request_guid,listing_key:n}}(s,i,a)),I.a.debug("about to set cookie"),function e(t,i){var n=new Date;n.setTime(n.getTime()+1e4);var a={expires:n};Z.a.set("sponsOppId",i,a),Z.a.set("sponsLineItem",t,a)}(s.sl_line_item_id,s.opportunity_uid),I.a.debug("about to send click log"),function e(t){fetch("/SponsoredListingCommerce/1.0/click",{method:"POST",headers:new Headers({"content-type":"application/json","x-requested-by":ie()}),credentials:"same-origin",body:JSON.stringify(t)}).then(function(e){return e.ok||I.a.debug("Did not get an ok. got: ".concat(e.statusText)),e}).catch(function(e){I.a.error("Error sending commerce click: ".concat(e.message))})}(function e(t,i,n,a){var s=Object(f.getStore)().getState();return{area:t.placement_slot_name,click_type:"HR",dest:"Hotel_Review",from:s.route.page,listing_key:a,impression_key:t.impression_key,is_backfill:t.is_backfill,line_item_id:t.dfp_lineitem_id,sl_line_item_id:t.sl_line_item_id,trip_ads_id:t.trip_ads_id,location_id:i,slot:n,tt_placement:t.tt_placement,gosox:t.gosox}}(s,i,n,a)),function e(t){if(t){var i=document.getElementById("SP_PARTNER_NOTIFICATION_IFRAME");i||((i=document.createElement("iframe")).setAttribute("id","SP_PARTNER_NOTIFICATION_IFRAME"),i.setAttribute("style","position: absolute; visibility: hidden; right: 0; bottom: 0; width: 1px; height: 1px"),document.body&&document.body.appendChild(i)),i.src=t}}(s.partner_notification_url),s.trip_ads_select_request_guid&&(I.a.debug("about to send TripAds click event"),function e(t,i){te(t,i,"CLICKED")}(s.trip_ads_select_request_guid,s.opportunity_uid))}},se={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"LogClickInteraction"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uniqueId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"impressionKey"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"placementName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pageLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"logInteraction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"interaction"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"uniqueId"},value:{kind:"Variable",name:{kind:"Name",value:"uniqueId"}}},{kind:"ObjectField",name:{kind:"Name",value:"hotelReviewServlet"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"listing"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"impressionKey"},value:{kind:"Variable",name:{kind:"Name",value:"impressionKey"}}},{kind:"ObjectField",name:{kind:"Name",value:"locationId"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}},{kind:"ObjectField",name:{kind:"Name",value:"placementName"},value:{kind:"Variable",name:{kind:"Name",value:"placementName"}}},{kind:"ObjectField",name:{kind:"Name",value:"pageLocation"},value:{kind:"Variable",name:{kind:"Name",value:"pageLocation"}}}]}}]}}]}}],directives:[]}]}}],loc:{start:0,end:443}};se.loc.source={body:"f0f6c06062cd"};var oe=se,re=function e(t,i){if(t.suppressedSponsoredLocationId){var n=Object(f.getStore)().getState().route.page,a={module:"sp_suppression_test|".concat(n),action:i,context:String(t.suppressedSponsoredLocationId)};R()(a)}},le=function e(t,i){if(i){var n=i,a=ne(),s=b()({},a,{is_dynamic_listing:!1,placement_slot_name:n.placement_slot_name,slot_index:t.indexInList,location_id:t.locationId,sponsored_type:n.sponsored_type,candidate_location_ids:n.candidate_location_ids,chosen_location_id:t.locationId,has_valid_candidate:!0,current_state:"location_shown",opportunity_uid:n.opportunity_uid,dfp_lineitem_id:n.dfp_lineitem_id,sl_line_item_id:n.sl_line_item_id,trip_ads_id:n.trip_ads_id,trip_ads_select_guid:n.trip_ads_select_request_guid,listing_key:t.listingKey});Object(q.trackEventWithContext)("impression","paid_backup_sponsored_listing_displayed",s),Object(q.trackHolisticEvent)(q.holisticEvents.HOTELS_SP_IMPRESSION,function e(t,i,n){var a=Object(f.getStore)().getState();return{is_member:a.auth.isMember,device_type:a.meta.device.userAgentCategory?a.meta.device.userAgentCategory.toLowerCase():"",locationId:i,slot:t.placement_slot_name,trip_ads_select_guid:t.trip_ads_select_request_guid,listing_key:n}}(n,t.locationId,t.listingKey)),n.trip_ads_select_request_guid&&function e(t,i){te(t,i,"IMPRESSED")}(n.trip_ads_select_request_guid,n.opportunity_uid),re(t,"impression")}else re(t,"impression")},ce=function e(t){switch(t){case"ar":return{trackingName:"xsell_hr_abovereviews"};case"br":return{trackingName:"xsell_hr_belowreviews"};default:return function e(t){return{trackingName:"xsell_hr_".concat(t)}}(t)}},de=function e(t){var i=ce(t.pageLocation),n={module:"".concat(i.trackingName,"_shelf_").concat(t.rowNumber),action:"shelf_click",value:t.indexInList,context:t.displayPrice};R()(n)},ue=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;a()(this,e),E()(this,"clockStarted",!1),E()(this,"clockStopped",!1),E()(this,"startTime",0),E()(this,"timeoutCallback",void 0),E()(this,"timeoutTimer",void 0),E()(this,"timeout",void 0),this.timeoutCallback=t,this.timeout=i}return o()(e,[{key:"clockStart",value:function e(){var t=this;if(!this.clockStarted){this.clockStarted=!0,this.startTime=Date.now();var i=this;this.timeoutTimer=setTimeout(function(){return i.handleTimeout(t.timeout)},this.timeout)}}},{key:"clockStop",value:function e(t){this.clockStarted&&!this.clockStopped&&(this.clockStopped=!0,t(Date.now()-this.startTime),clearTimeout(this.timeoutTimer))}},{key:"handleTimeout",value:function e(t){this.clockStopped||(this.clockStopped=!0,this.timeoutCallback(t))}},{key:"reset",value:function e(){this.clockStarted=!1,this.clockStopped=!1,this.startTime=0,clearTimeout(this.timeoutTimer)}}]),e}(),pe=function e(t){var i=this;a()(this,e),E()(this,"clock",void 0),E()(this,"trackingModule",void 0),E()(this,"shelfNameAndLocation",void 0),E()(this,"crossSellType",void 0),E()(this,"inViewAdditionalTrackingEvent",void 0),E()(this,"isTerminalDisplayState",function(e){return e.displayState===A.DisplayState.SHOWING||e.displayState===A.DisplayState.HIDDEN&&e.isOverallComplete}),E()(this,"handleClockFired",function(e,t){var i=b()({},t,{value:e});R()(i)}),E()(this,"startTracking",function(e,t){return i.handleVisibleShelf(e,t)}),E()(this,"handleVisibleShelf",function(e,t){var n=i.convertShelfNameToCategory(i.crossSellType);if(t<=1){var a={module:i.trackingModule,action:"in_view",context:"hr_xs_".concat(n,"_view")};R()(a),i.inViewAdditionalTrackingEvent&&R()({module:i.trackingModule,action:"in_view",context:i.inViewAdditionalTrackingEvent})}i.clock.clockStart(),i.checkAndStopTracking(e)}),E()(this,"convertShelfNameToCategory",function(e){switch(e){case"scpc":case"smms":case"sfmmsf":return"similar";case"sfmms":return"similar_filtered";case"m":case"mbmms":return"most_booked";case"nnrc":case"nmms":return"nearby";case"ci":case"cmms":return"cheap";case"cg":case"gmms":return"grid";case"samms":return"savers";default:return"unknown"}}),E()(this,"checkAndStopTracking",function(e){if(i.isTerminalDisplayState(e)){var t={module:"xsell_loading_timing",action:e.displayState,context:i.shelfNameAndLocation};i.clock.clockStop(function e(n){i.handleClockFired(n,t)})}}),E()(this,"resetTime",function(){i.clock.reset()});var n=ce(t.locationName),s="".concat(n.trackingName,"_shelf_").concat(t.rowNumber),o="new_".concat(t.locationName,"_").concat(t.crossSellType,"_").concat(t.rowNumber);this.trackingModule=s,this.shelfNameAndLocation=o,this.crossSellType=t.crossSellType,this.inViewAdditionalTrackingEvent=t.inViewAdditionalTrackingEvent,this.clock=new ue(function(e){var t={module:"xsell_loading_timing",action:"timeout",context:i.shelfNameAndLocation};i.handleClockFired(e,t)})},me=i("@ta/common.i18n"),ge=function e(){return Object(me.localize)("p13n_you_may_also_like")},_e=function e(t){var i=z();return function e(t,i,n){return i&&t&&i[t]?i[t]:n}(t,$()(i,"titles",null),ge())},he=function e(t){var i=z(),n=$()(i,"seeAllLinks",null);return function e(t,i,n){return i&&t&&i[t]?i[t]:n}(t,n,$()(n,"default",null))};i.d(t,"UiAssetLoader",function(){return h}),i.d(t,"ComparisonGridDataLoader",function(){return S}),i.d(t,"WaitForPageLocation",function(){return X}),i.d(t,"getUIAssets",function(){return z}),i.d(t,"CrossSellsDisplayStateManager",function(){return G}),i.d(t,"sponsoredListingClickHandler",function(){return ae}),i.d(t,"LogClickInteraction",function(){return oe}),i.d(t,"sponsoredListingImpressionHandler",function(){return le}),i.d(t,"gaRecordClickHandler",function(){return de}),i.d(t,"ShelfTimingTracker",function(){return pe}),i.d(t,"getTitleForCrossSellType",function(){return _e}),i.d(t,"getDefaultShelfTitle",function(){return ge}),i.d(t,"getSeeAllUrlForCrossSellType",function(){return he})}}});
//# sourceMappingURL=cross-sells.logic.d7c92e55b9.js.map